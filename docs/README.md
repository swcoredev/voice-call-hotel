# Voice Call Hotel ‚Äî –ú–æ–¥—É–ª–∏ –∏ API

## –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π

- **tts** ‚Äî —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ (Text-to-Speech). –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ElevenLabs API.
- **stt** ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ (Speech-to-Text). –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Ö –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Whisper/OpenAI –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.
- **lang** ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è (Intent Detection). –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Ö —Å–º—ã—Å–ª.

## –ü—Ä–∏–º–µ—Ä—ã API-–∑–∞–ø—Ä–æ—Å–æ–≤

- `GET  /api/v1/tts/welcome` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –∞—É–¥–∏–æ—Å–æ–æ–±—â–µ–Ω–∏–µ (–æ—Ç–¥–∞—ë—Ç —Ñ–∞–π–ª –∏–∑ static, –Ω–∞–ø—Ä–∏–º–µ—Ä, ElevenLabs_Untitled_Project.wav)
- `POST /api/v1/stt/process` ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞—É–¥–∏–æ—Ñ–∞–π–ª –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ (multipart/form-data)
- `POST /api/v1/lang/analyze` ‚Äî –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã stt

–ú–æ–¥—É–ª—å **stt** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ª—é–±—ã–µ –∞—É–¥–∏–æ—Ñ–æ—Ä–º–∞—Ç—ã (mp3, wav, m4a –∏ –¥—Ä.), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ ffmpeg, –≤ —Ñ–æ—Ä–º–∞—Ç WAV 16kHz mono –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è STT
–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏:

```bash
bash test_stt_script.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª `client_request.m4a` –∏–∑ –ø–∞–ø–∫–∏ `static/` –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç:

POST http://localhost:8000/api/v1/stt/process

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.

---

## üß† –î–∏–∞–ª–æ–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ STT + LANG

–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞:
```bash
./scripts/test_lang_script.sh static/client_request.m4a
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

üéôÔ∏è  –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–Ω–µ –Ω—É–∂–Ω–∞ —É–±–æ—Ä–∫–∞ –≤ –Ω–æ–º–µ—Ä–µ 217 —Å–µ–≥–æ–¥–Ω—è –≤–µ—á–µ—Ä–æ–º. –°–ø–∞—Å–∏–±–æ.
üí≠ –û—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞: –ö–æ–Ω–µ—á–Ω–æ, —É–±–æ—Ä–∫–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Å–µ–≥–æ–¥–Ω—è –≤–µ—á–µ—Ä–æ–º –≤ –Ω–æ–º–µ—Ä–µ 217. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —á—Ç–æ-—Ç–æ –µ—â—ë, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–∞–π—Ç–µ –∑–Ω–∞—Ç—å!

–°–∫—Ä–∏–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª –Ω–∞ STT, –∑–∞—Ç–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –Ω–∞ LANG, –∏ –≤—ã–≤–æ–¥–∏—Ç –æ–±–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ TTS
- –î–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/v1/tts/welcome`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏–æ—Ñ–∞–π–ª –∏–∑ –ø–∞–ø–∫–∏ `static` (–Ω–∞–ø—Ä–∏–º–µ—Ä, ElevenLabs_Untitled_Project.wav).
- –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏ —á–µ—Ä–µ–∑ ElevenLabs –¥–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç `test_tts.py` (—Å–º. –ø–∞–ø–∫—É `voice_call_handler/tts/`).
- –í—Å—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (API-–∫–ª—é—á–∏, voice_id –∏ —Ç.–¥.) —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.env`.

---

## üß† Intent Detection (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è)

–ú–æ–¥—É–ª—å LANG –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI (gpt-4o) –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ–º–µ—Ä–∞ –∫–æ–º–Ω–∞—Ç—ã, –≤—Ä–µ–º–µ–Ω–∏ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

- –§—É–Ω–∫—Ü–∏—è `detect_intent(text: str) -> dict` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –ø–æ–ª—è–º–∏:
  - `intent`: –Ω–∞–ø—Ä–∏–º–µ—Ä, "room_cleaning", "food_order", "late_checkout", "unknown"
  - `room_number`: –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, "217")
  - `time`: –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "evening", "tomorrow")
  - `confidence`: –æ—Ç 0 –¥–æ 1

–ú–æ–¥–µ–ª—å –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–≥–æ JSON-–æ—Ç–≤–µ—Ç, —É—Å—Ç–æ–π—á–∏–≤—ã–π –∫ markdown-–æ–±—ë—Ä—Ç–∫–µ.

### –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞

```python
from voice_call_handler.lang.logic import detect_intent

def test_room_cleaning():
    result = detect_intent("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ—Ä–∏—Ç–µ –≤ –Ω–æ–º–µ—Ä–µ 305 —Å–µ–≥–æ–¥–Ω—è –≤–µ—á–µ—Ä–æ–º.")
    assert result["intent"] == "room_cleaning"
    assert str(result["room_number"]) == "305"
    assert result["confidence"] > 0.5
```

–¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π:
```bash
pytest voice_call_handler/tests/test_detect_intent.py
```

--- 