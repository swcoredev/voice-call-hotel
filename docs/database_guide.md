# Руководство по базе данных

## Настройка базы данных

База данных PostgreSQL установлена локально и настроена со следующими параметрами:

```bash
# Параметры подключения
Host: localhost
Port: 5432
Database: voice_hotel_db_test
User: adminvoice
Password: SecurePass123
```

## Переменные окружения

В файле `.env` должны быть настроены следующие переменные для работы с базой данных:

```bash
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=voice_hotel_db_test
POSTGRES_USER=adminvoice
POSTGRES_PASSWORD=SecurePass123
DATABASE_URL="postgresql://adminvoice:SecurePass123@localhost:5432/voice_hotel_db_test"
```

## Структура базы данных

База данных содержит две основные таблицы:

### Таблица `calls`
Хранит информацию о звонках:
- `id` - уникальный идентификатор звонка (SERIAL PRIMARY KEY)
- `session_id` - UUID сессии (генерируется автоматически)
- `start_time` - время начала звонка (с часовым поясом)
- `end_time` - время окончания звонка (с часовым поясом)
- `status` - статус звонка (VARCHAR(50))

### Таблица `dialogs`
Хранит диалоги пользователя с системой:
- `id` - уникальный идентификатор диалога (SERIAL PRIMARY KEY)
- `call_id` - ссылка на звонок (FOREIGN KEY)
- `timestamp` - время реплики (с часовым поясом)
- `user_input` - текст пользователя
- `system_response` - ответ системы
- `intent` - определенное намерение пользователя
- `confidence` - уверенность в определении намерения

## Инициализация базы данных

База данных инициализируется с помощью скрипта `scripts/init_db.py`. Скрипт:
1. Создает базу данных если она не существует
2. Создает необходимые таблицы
3. Настраивает связи между таблицами

## Проверка настроек

Для проверки настроек окружения используйте скрипт `scripts/check_env.py`. Он проверит наличие всех необходимых переменных окружения.

## Полезные команды

```bash
# Просмотр списка баз данных
psql -l

# Просмотр таблиц в базе данных
psql voice_hotel_db_test -c "\dt"

# Подключение к базе данных
psql voice_hotel_db_test

# Проверка статуса PostgreSQL
brew services list | grep postgresql
```

## Примечания по безопасности

1. Файл `.env` не должен попадать в систему контроля версий
2. Пароли и ключи API должны храниться в безопасном месте
3. В продакшене рекомендуется использовать более сложные пароли
4. Рекомендуется регулярное резервное копирование базы данных 