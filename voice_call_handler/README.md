# –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ Python 3.13 (–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π LTS)
FROM python:3.13-rc

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã
COPY . /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN pip install --no-cache-dir --upgrade pip \
 && pip install --no-cache-dir -r requirements.txt

# –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Ä—Ç
EXPOSE 8000

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

# voice_call_handler

–ú–æ–¥—É–ª—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –æ—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

---

## üìû Voice-–º–æ–¥—É–ª—å (–∑–∞–≤–µ—Ä—à—ë–Ω)

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ POST-–∑–∞–ø—Ä–æ—Å–∞ –æ—Ç Twilio –Ω–∞ `/api/v1/voice`
- [x] –ì–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–≤–µ—Ç –æ—Ç–¥–∞—ë—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ TwiML (XML) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Polly (—Ä—É—Å—Å–∫–∏–π –≥–æ–ª–æ—Å)
- [x] –ü–æ–¥–∫–ª—é—á—ë–Ω —á–µ—Ä–µ–∑ Flask Blueprint `voice_bp`
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω —á–µ—Ä–µ–∑ Cloudflare Tunnel –∏ Twilio Webhook
- [x] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Gunicorn –Ω–∞ –ø–æ—Ä—Ç—É `8000`

```bash
gunicorn main:app
```

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X POST https://voice.servis.work/api/v1/voice
```

## ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ 2025-05-24

- [x] –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- [x] –ó–∞–ø—É—â–µ–Ω FastAPI-—Å–µ—Ä–≤–µ—Ä
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω POST-–∑–∞–ø—Ä–æ—Å `/voice/process-voice/` —á–µ—Ä–µ–∑ Swagger
- [x] –°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Ñ—Ä–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤

---

## üåø –í–µ—Ç–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–µ—Ç–∫–∞: `voice-stt-start`  
–ó–∞–¥–∞—á–∞: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ (STT) —á–µ—Ä–µ–∑ Whisper.

---

## ‚è≠ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

üîä **–î–æ–±–∞–≤–∏—Ç—å STT (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ —Å Whisper)**  
–ß—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∏ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –∏—Ö –≤ —Ç–µ–∫—Å—Ç.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- `router.py` ‚Äî FastAPI-—Ä–æ—É—Ç, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç
- `logic.py` ‚Äî –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ—Ä–∞–∑
- `stt.py` / `tts.py` ‚Äî –±—É–¥—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –ø–æ–∑–∂–µ
- `service.py` ‚Äî –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–æ–∫
- `schemas.py`, `utils.py` ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ
- `logs/` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤
- `docs/` ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∫–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

---

## üß™ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ `.venv` —Å–æ–∑–¥–∞–Ω–æ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ  
‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```bash
pip install fastapi uvicorn
```

‚úÖ –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å–æ—Ö—Ä–∞–Ω—ë–Ω:

```bash
pip freeze > requirements.txt
```

‚úÖ `.venv` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`  
‚úÖ –ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (STT)

---

## üê≥ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–¥ Docker

–ú–æ–¥—É–ª—å `voice_call_handler` –±—É–¥–µ—Ç –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏:

- `Dockerfile` ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–±–æ—Ä–∫—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `docker-compose.yml` ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏

### –ü–ª–∞–Ω:

1. –°–æ–∑–¥–∞—Ç—å `Dockerfile` —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∑–∞–ø—É—Å–∫–æ–º `uvicorn`
2. –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç `8000` (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π, –µ—Å–ª–∏ –±—É–¥–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç)
3. –û–±–µ—Å–ø–µ—á–∏—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `docker-compose.yml` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

> –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ STT-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.